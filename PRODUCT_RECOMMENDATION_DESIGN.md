# 📋 产品推荐系统升级设计方案

> 版本：v2.0（AI 为主方案）  
> 日期：2026-01-21  
> 状态：设计评审中

---

## 一、项目背景

### 1.1 现有系统问题

| 问题 | 描述 | 影响 |
|------|------|------|
| 产品库有限 | 仅 8 个虚拟产品 | 无法满足真实业务场景 |
| 单产品推荐 | 只能推荐 1 个产品 | 无法覆盖完整治疗链路 |
| 匹配粗糙 | AI 直接选择，缺乏规则约束 | 推荐准确率不可控 |
| 话术冗余 | 3 段式话术占用空间 | 实际使用价值低 |

### 1.2 升级目标

1. **AI 智能匹配**：让 AI 理解症状语义，自动匹配最合适的产品
2. **多产品推荐**：支持 1-5 个产品组合推荐，覆盖检测→治疗→调理全链路
3. **真实产品库**：整合 254 条真实产品数据
4. **简化展示**：移除话术，聚焦产品本身
5. **持续优化**：记录医生确认的推荐，作为后续训练材料

---

## 二、页面布局设计

### 2.1 整体布局（三栏结构）

```
┌─────────────────────────────────────────────────────────────────────────────┐
│                              问诊分析界面                                      │
├────────────────────┬────────────────────────────────────────────────────────┤
│                    │                                                        │
│  【左侧 - 语音流】   │               【右侧 - 分析与推荐】                       │
│     (4列宽)        │                    (8列宽)                              │
│                    │  ┌──────────────────┬──────────────────────┐          │
│  ◉ 语音流推流中     │  │ 01 临床特征提取   │ 02 智能产品推荐       │          │
│                    │  │                  │                      │          │
│  ┌──────────────┐  │  │ • 健康问题       │ 识别疾病: 呼吸道感染   │          │
│  │ 医生: ...    │  │  │ • 高危风险点     │ 匹配置信度: 92%       │          │
│  └──────────────┘  │  │ • 建议摘要       │                      │          │
│  ┌──────────────┐  │  │                  │ ┌────────────────────┐│          │
│  │ 患者: ...    │  │  │                  │ │ 🧪 菲佑宁           ││          │
│  └──────────────┘  │  │                  │ │ 流感快速检测...     ││          │
│                    │  │                  │ └────────────────────┘│          │
│  ▁▂▃▄▅▆▇█▇▆▅▄▃▂▁    │  │                  │ ┌────────────────────┐│          │
│  [中止问诊任务]      │  │                  │ │ 💊 双黄连口服液     ││          │
│                    │  │                  │ │ 疏风解表，清热...    ││          │
│                    │  │                  │ └────────────────────┘│          │
│                    │  │                  │ ┌────────────────────┐│          │
│                    │  │                  │ │ 🌿 维生素C片        ││          │
│                    │  │                  │ │ 增强免疫屏障...      ││          │
│                    │  │                  │ └────────────────────┘│          │
│                    │  │                  │                      │          │
│                    │  │                  │ [确认并发送推荐]      │          │
│                    │  └──────────────────┴──────────────────────┘          │
└────────────────────┴────────────────────────────────────────────────────────┘
```

### 2.2 产品卡片设计

```
┌───────────────────────────────────────────────────┐
│ 🧪 快速检测                          匹配度: 95%  │
├───────────────────────────────────────────────────┤
│                                                   │
│  菲佑宁                                           │
│                                                   │
│  【临床价值】呼吸道感染初期（48小时内）使用。用于    │
│  快速筛查流感/甲流病毒，辅助医生判断是否需使用      │
│  奥司他韦等抗病毒药物，避免抗生素滥用。            │
│                                                   │
└───────────────────────────────────────────────────┘
```

### 2.3 类别视觉方案

| 推荐类别 | 图标 | 主色调 | 边框色 | 背景色 |
|----------|------|--------|--------|--------|
| 快速检测 | 🧪 | #3B82F6 (蓝) | blue-500/30 | blue-500/10 |
| 推荐药品 | 💊 | #10B981 (绿) | emerald-500/30 | emerald-500/10 |
| 商城保健品 | 🌿 | #F59E0B (橙) | amber-500/30 | amber-500/10 |
| 保健品(方案) | ⚡ | #8B5CF6 (紫) | violet-500/30 | violet-500/10 |
| 其他产品 | ✨ | #EAB308 (金) | yellow-500/30 | yellow-500/10 |

---

## 三、智能匹配逻辑设计（核心）

### 3.1 匹配流程总览（AI 为主架构）

> **设计原则**：AI 做核心判断，规则做辅助预筛选。因为最终有医生把关，所以重点是让 AI 理解症状语义，给出合理推荐。

```
┌─────────────────────────────────────────────────────────────────────────┐
│                        智能匹配引擎（AI 为主）                            │
└─────────────────────────────────────────────────────────────────────────┘
                                    │
                                    ▼
┌─────────────────────────────────────────────────────────────────────────┐
│  输入：诊断结果                                                           │
│  • 健康问题: ["咳嗽", "咽痛", "流涕"]                                     │
│  • 风险点: ["近期天气变化", "接触流感患者"]                                │
│  • 诊断摘要: "患者出现典型上呼吸道感染症状..."                             │
└─────────────────────────────────────────────────────────────────────────┘
                                    │
                                    ▼
            ┌─────────────────────────────────────────────────┐
            │          第一步：快速预筛选（规则辅助）            │
            │                                                 │
            │  目的：缩小候选产品范围，减少 AI 处理量            │
            │  • 根据症状关键词初步筛选相关疾病类型              │
            │  • 从 254 个产品中筛选出 10-30 个候选产品         │
            │  • 耗时：毫秒级                                  │
            └─────────────────────────────────────────────────┘
                                    │
                                    ▼
            ┌─────────────────────────────────────────────────┐
            │          第二步：AI 智能匹配（核心决策）           │
            │                                                 │
            │  AI 接收：                                       │
            │  • 完整的诊断描述                                 │
            │  • 候选产品列表（含每个产品的匹配规则说明）         │
            │                                                 │
            │  AI 输出：                                       │
            │  • 判断的疾病类型                                 │
            │  • 推荐的产品（1-5个）                            │
            │  • 每个产品的推荐理由                             │
            │  • 置信度评估                                    │
            │                                                 │
            │  耗时：1-2 秒                                    │
            └─────────────────────────────────────────────────┘
                                    │
                                    ▼
            ┌─────────────────────────────────────────────────┐
            │          第三步：医生确认                         │
            │                                                 │
            │  • 医生查看 AI 推荐的产品                         │
            │  • 医生可以调整、增删产品                         │
            │  • 医生语音推荐给患者 → 标记为"已推荐"            │
            │  • 已推荐记录保存，用于后续训练优化                │
            └─────────────────────────────────────────────────┘
```

### 3.2 预筛选规则（辅助层）

> **定位**：不做决策，只是快速缩小范围。关键词不需要覆盖所有情况，只要能筛选出大致相关的疾病类型即可。

#### 3.2.1 简化的疾病-关键词映射

预筛选只需要简单的关键词列表，用于快速缩小候选产品范围：

| 疾病类型 | 触发关键词（命中任意一个即可） |
|----------|-------------------------------|
| 呼吸道感染 | 感冒、流感、咳嗽、咽痛、发热、流涕、鼻塞 |
| 消化系统 | 胃痛、腹泻、便秘、反酸、恶心、消化不良 |
| 妇科问题 | 白带、阴道炎、月经不调、痛经 |
| 心血管 | 高血压、心悸、胸闷、头晕 |
| 皮肤问题 | 湿疹、过敏、瘙痒、皮炎 |
| ... | ... |

**关键点**：
- 关键词不需要很全，漏了也没关系，AI 会兜底
- 只要能筛选出大致相关的疾病类型，把候选产品从 254 个缩减到 20-30 个即可
- 如果没有匹配到任何关键词，就把全部产品都交给 AI 判断

#### 3.2.2 预筛选逻辑（非常简单）

预筛选的唯一目的是：**缩小候选产品范围，让 AI 处理更快**

处理流程：
1. 遍历诊断中的健康问题
2. 检查是否包含上表中的任意关键词
3. 如果命中，筛选出对应疾病类型的产品作为候选
4. 如果没有命中任何关键词，把所有产品都作为候选（让 AI 来判断）

**示例**：
- 诊断包含"咳嗽、流涕" → 命中"呼吸道感染" → 筛选出呼吸道相关的 30 个产品
- 诊断包含"肚子咕噜响" → 未命中任何关键词 → 把全部 254 个产品交给 AI
    对于 每个组合 在 疾病.高置信组合:
        如果 组合 是 症状集合的子集:
            加分 += 组合对应的分数
            # 一旦命中高置信组合，可以提前返回高分
    
    # 检查中置信组合
    对于 每个组合 在 疾病.中置信组合:
---

### 3.3 AI 智能匹配（核心决策层）

这是整个推荐系统的核心。AI 负责理解症状语义、判断疾病类型、选择合适产品。

#### 3.3.1 为什么用 AI 做核心决策？

| 问题 | 关键词匹配 | AI 判断 |
|------|------------|---------|
| "嗓子痒痒的" | ❌ 未收录 | ✅ 理解为咽喉不适 |
| "肚子咕噜响" | ❌ 未收录 | ✅ 理解为肠胃问题 |
| "浑身没劲" | ❌ 未收录 | ✅ 理解为乏力 |
| "最近老是跑厕所" | ❌ 未收录 | ✅ 理解为腹泻/尿频 |

**结论**：患者的表达千变万化，关键词永远列不完，而 AI 天然具备语义理解能力。

#### 3.3.2 AI 如何工作？

AI 收到的输入：
1. **诊断描述**：患者的症状、医生的初步判断
2. **候选产品列表**：预筛选出的 10-30 个产品，每个产品都带有「适用场景」和「匹配规则」

AI 输出的结果：
1. **判断的疾病类型**：如"呼吸道感染"
2. **推荐的产品**：1-5 个，按优先级排序
3. **每个产品的推荐理由**：简短说明为什么推荐
4. **置信度**：AI 对自己判断的信心程度

#### 3.3.3 AI 的优势

1. **语义理解**：能理解"嗓子发紧"="咽喉不适"，不需要穷举同义词
2. **症状组合推理**：能从"发热+咳嗽+流涕"推断出"上呼吸道感染"
3. **产品规则理解**：能读懂产品的「匹配规则」，判断是否适合当前症状
4. **自然语言输出**：能生成通顺的推荐理由，方便医生理解

#### 3.3.4 AI 的边界

1. **有医生把关**：AI 只是给医生提供参考，最终由医生决定是否推荐给患者
2. **不做最终诊断**：AI 只做产品匹配，不做医学诊断
3. **异常降级**：如果 AI 服务异常，显示"暂时无法推荐，请医生自行选择"

### 3.4 置信度说明

置信度由 AI 自评，表示 AI 对自己推荐结果的信心程度：

| 置信度 | 含义 | 界面提示 |
|--------|------|----------|
| ≥ 80% | AI 非常确定 | 正常显示推荐 |
| 60-79% | AI 比较确定 | 正常显示，可考虑人工确认 |
| < 60% | AI 不太确定 | 显示"建议人工判断" |

**重要说明**：
- 置信度只是参考，最终由医生决定
- 医生确认推荐后，该记录会被标记为"已推荐"，用于后续优化

---

## 四、产品筛选与排序

### 4.1 AI 如何选择产品？

AI 在选择产品时会考虑以下因素：

1. **症状匹配度**：产品的「匹配规则」与当前症状是否吻合
2. **产品类别优先级**：检测类 > 药品类 > 保健品类
3. **产品数量控制**：一般推荐 1-5 个产品

### 4.2 推荐产品类别说明

| 类别 | 说明 | 推荐时机 |
|------|------|----------|
| 🧪 快速检测 | 如流感检测、HP检测 | 需要确诊时 |
| 💊 推荐药品 | 对症治疗的药物 | 症状明确时 |
| 🌿 商城保健品 | 辅助调理的保健品 | 辅助治疗/长期调理 |

---

## 五、医生确认与训练数据收集

### 5.1 医生确认流程

```
┌─────────────────────────────────────────────────────────────┐
│                     AI 推荐产品                              │
│  ┌─────────────────────────────────────────────────────┐    │
│  │ 🧪 菲佑宁（流感检测）                                │    │
│  │ 💊 双黄连口服液                                      │    │
│  │ 🌿 维生素C片                                        │    │
│  └─────────────────────────────────────────────────────┘    │
│                                                             │
│     [✓ 确认推荐]      [✏️ 调整后推荐]      [✗ 不推荐]        │
└─────────────────────────────────────────────────────────────┘
```

医生操作：
1. **确认推荐**：医生认可 AI 推荐，语音向患者推荐这些产品
2. **调整后推荐**：医生修改产品列表后推荐
3. **不推荐**：医生认为不需要推荐产品

### 5.2 推荐记录标记

当医生确认推荐后，系统自动保存以下信息：

| 字段 | 说明 | 用途 |
|------|------|------|
| 诊断摘要 | 患者的症状描述 | 训练输入 |
| AI 推荐产品 | AI 原始推荐 | 对比分析 |
| 医生最终推荐 | 医生确认的产品 | 训练标签 |
| 推荐时间 | 操作时间戳 | 追溯 |
| 是否有调整 | 医生是否修改了 AI 推荐 | 效果评估 |

### 5.3 训练数据的价值

收集的数据可用于：

1. **评估 AI 准确率**：统计"医生直接确认"vs"医生调整后确认"的比例
2. **发现匹配规则漏洞**：分析 AI 频繁推荐错误的场景
3. **优化 AI Prompt**：将医生修正的案例加入 Prompt 示例
4. **长期模型训练**：积累足够数据后可用于微调 AI 模型

### 5.4 数据反馈闭环

```
     AI 推荐
        │
        ▼
    医生确认/调整
        │
        ▼
    保存推荐记录
        │
        ▼
   定期分析（周/月）
        │
        ├──→ 准确率高：继续当前策略
        │
        └──→ 准确率低：
               ├──→ 补充关键词
               ├──→ 优化 AI Prompt
               └──→ 调整产品匹配规则
```

---

## 六、数据结构定义

### 6.1 产品数据结构

```typescript
interface Product {
  id: string;                    // 唯一标识，如 "resp-drug-001"
  name: string;                  // 产品名称
  brand?: string;                // 品牌（可选）
  category: ProductCategory;     // 推荐类别
  disease: DiseaseType;          // 对应疾病
  diseaseType: "常见病" | "慢性病";
  diseaseDescription: string;    // 疾病描述
  description: string;           // 产品描述/推荐理由
  matchRule: string;             // 详细匹配规则
  priority: number;              // 优先级 1-10
  keywords: string[];            // 关联关键词
}

type ProductCategory = 
  | "快速检测" 
  | "推荐药品" 
  | "商城保健品" 
  | "保健品(方案)" 
  | "其他产品";

type DiseaseType = 
  | "呼吸道感染" 
  | "消化系统疾病" 
  | "妇科炎症" 
  | "高血压及心血管问题";
```

### 6.2 推荐结果数据结构

```typescript
interface RecommendationResult {
  // 疾病识别
  matchedDisease: {
    name: DiseaseType;
    confidence: number;           // 0-100
    confidenceLevel: "高" | "中" | "低";
    hitKeywords: string[];
    secondaryDisease?: {
      name: DiseaseType;
      confidence: number;
    };
  };
  
  // 推荐产品
  products: RecommendedProduct[];
  
  // 校验结果
  validation: {
    passed: boolean;
    warnings: string[];
  };
}

interface RecommendedProduct {
  product: Product;
  matchScore: number;             // 产品匹配度 0-100
  recommendReason: string;        // 推荐理由
}
```

---

## 七、异常处理

| 场景 | 处理方式 |
|------|----------|
| 诊断信息为空 | 显示"暂无足够信息进行推荐" |
| AI 服务异常 | 显示"服务暂时不可用，请医生自行选择" |
| 无匹配产品 | 显示"暂无推荐产品" |

---

## 八、实施计划

### 8.1 开发阶段

| 阶段 | 任务 | 预估时间 |
|------|------|----------|
| 1 | Excel 数据转换为系统可用格式 | 0.5天 |
| 2 | 实现简单的预筛选逻辑 | 0.5天 |
| 3 | 实现 AI 智能匹配模块 | 1天 |
| 4 | 重构 UI 右侧面板（展示产品卡片） | 1天 |
| 5 | 实现医生确认与记录保存 | 0.5天 |
| 6 | 移除三段式话术代码 | 0.5天 |
| 7 | 测试与调优 | 1天 |

**总计：约 5 天**

---

## 九、总结

### 核心设计思路

1. **AI 为主**：让 AI 理解症状语义，自动匹配产品
2. **规则辅助**：简单的关键词预筛选，缩小候选范围
3. **医生把关**：AI 只是建议，最终由医生决定
4. **数据闭环**：收集医生确认的推荐，持续优化 AI

### 与原系统的主要变化

| 变化点 | 原系统 | 新系统 |
|--------|--------|--------|
| 产品数量 | 8 个虚拟产品 | 254 个真实产品 |
| 推荐方式 | 单产品 | 1-5 个产品组合 |
| 匹配逻辑 | AI 直接选择 | AI 智能语义匹配 |
| 展示内容 | 三段式话术 | 产品卡片列表 |
| 数据记录 | 无 | 保存医生确认的推荐 |

---

> **文档版本**：v2.0（AI 为主方案）  
> **最后更新**：2026-01-21
